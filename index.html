let lastFetchTime = Date.now();

function updateCountdown() {
    function tick() {
        let now = Date.now();
        let elapsed = now - lastFetchTime;

        // Reduce estimated time left based on actual passage of time
        estimatedTimeLeft -= 1000;

        if (elapsed >= 60000) {  // Re-sync every 1 minute
            fetchBlockData();  // Update estimated time from API
            lastFetchTime = now;
        }

        let seconds = Math.floor(estimatedTimeLeft / 1000);
        let days = Math.floor(seconds / (3600 * 24));
        seconds %= 3600 * 24;
        let hours = Math.floor(seconds / 3600);
        seconds %= 3600;
        let minutes = Math.floor(seconds / 60);
        seconds %= 60;

        document.getElementById("countdown").innerText = `${days}d ${hours}h ${minutes}m ${seconds}s`;

        if (estimatedTimeLeft > 0) {
            setTimeout(tick, 1000);
        }
    }
    tick();
}

async function startCountdown() {
    await fetchBlockData();
    lastFetchTime = Date.now();
    updateCountdown();
    setInterval(fetchBlockData, 60000); // Fetch new block data every 1 minute
}
