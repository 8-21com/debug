<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: black;
      }
      svg {
        width: 300px;
        height: auto;
        image-rendering: pixelated;
      }
    </style>
  </head>
  <body>
    <!-- SVG Character with Dynamic Number Placeholder -->
    <svg id="pixelArt" viewBox="0 0 75 85">
      <!-- Character -->
      <g id="character">
        <!-- Body -->
        <rect x="20" y="20" width="35" height="45" fill="orange" />
        <!-- Head -->
        <rect x="25" y="5" width="25" height="20" fill="pink" />
        <!-- Cap -->
        <rect x="25" y="0" width="25" height="5" fill="white" />
        <!-- Bitcoin Logo -->
        <rect x="35" y="40" width="5" height="5" fill="white" />
      </g>

      <!-- Dynamic Numbers -->
      <g id="blockNumbers" transform="translate(15, 70)"></g>
    </svg>

    <script>
      const numberPixels = {
        '0': [
          [1,1,1],
          [1,0,1],
          [1,0,1],
          [1,0,1],
          [1,1,1]
        ],
        '1': [
          [0,1,0],
          [1,1,0],
          [0,1,0],
          [0,1,0],
          [1,1,1]
        ],
        '2': [
          [1,1,1],
          [0,0,1],
          [1,1,1],
          [1,0,0],
          [1,1,1]
        ],
        '3': [
          [1,1,1],
          [0,0,1],
          [1,1,1],
          [0,0,1],
          [1,1,1]
        ],
        '4': [
          [1,0,1],
          [1,0,1],
          [1,1,1],
          [0,0,1],
          [0,0,1]
        ],
        '5': [
          [1,1,1],
          [1,0,0],
          [1,1,1],
          [0,0,1],
          [1,1,1]
        ],
        '6': [
          [1,1,1],
          [1,0,0],
          [1,1,1],
          [1,0,1],
          [1,1,1]
        ],
        '7': [
          [1,1,1],
          [0,0,1],
          [0,1,0],
          [1,0,0],
          [1,0,0]
        ],
        '8': [
          [1,1,1],
          [1,0,1],
          [1,1,1],
          [1,0,1],
          [1,1,1]
        ],
        '9': [
          [1,1,1],
          [1,0,1],
          [1,1,1],
          [0,0,1],
          [1,1,1]
        ]
      };

      async function fetchBlockHeight() {
        try {
          console.log('Fetching block height...');
          const response = await fetch('/r/blockheight'); // Make sure this endpoint works
          if (response.ok) {
            const blockHeight = await response.text();
            console.log('Block height fetched:', blockHeight);
            displayBlockHeight(blockHeight.trim());
          } else {
            console.error('Failed to fetch block height, response not OK');
          }
        } catch (error) {
          console.error('Failed to fetch block height:', error);
        }
      }

      function displayBlockHeight(height) {
        console.log('Displaying block height:', height);
        const blockNumbersGroup = document.getElementById('blockNumbers');
        blockNumbersGroup.innerHTML = ''; // Clear previous numbers

        const pixelSize = 2;
        let xOffset = 0;

        height.split('').forEach(digit => {
          const pattern = numberPixels[digit];
          if (!pattern) {
            console.error('Pattern not found for digit:', digit);
            return;
          }
          pattern.forEach((row, y) => {
            row.forEach((cell, x) => {
              if (cell) {
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', xOffset + x * pixelSize);
                rect.setAttribute('y', y * pixelSize);
                rect.setAttribute('width', pixelSize);
                rect.setAttribute('height', pixelSize);
                rect.setAttribute('fill', 'black');
                blockNumbersGroup.appendChild(rect);
              }
            });
          });
          xOffset += (pattern[0].length + 1) * pixelSize; // Space between numbers
        });
      }

      fetchBlockHeight();
      setInterval(fetchBlockHeight, 60000); // Update every minute
    </script>
  </body>
</html>
